<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Edit RSVP</title>
<style>
body{font:16px/1.4 Inter,system-ui;-webkit-font-smoothing:antialiased;margin:0;min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:24px;background:url('./images/HackneyWick.png') center/cover fixed no-repeat;background-color:rgba(0,0,0,.08);background-blend-mode:multiply}
.wrap{max-width:720px;margin:0 auto;background:#fffdf6;border-radius:16px;padding:24px;box-shadow:0 16px 32px rgba(31,42,68,.15)}
label{font-weight:700;display:block;margin:.75rem 0 .25rem}
input,textarea,select,button{font:inherit}
input,textarea,select{width:100%;padding:.6rem;border:2px solid #e5e7eb;border-radius:10px;background:#fff}
button{margin-top:12px;padding:.7rem 1rem;border:0;border-radius:10px;background:#243354;color:#fff;font-weight:800}
.row{display:grid;grid-template-columns:2fr 1fr;gap:12px}
.hint{font-size:12px;color:#6b7280;margin-top:4px}
</style>
<div class="wrap">
  <h1>Edit your RSVP</h1>
  <div id="status"></div>
  <div class="row">
    <div><label>Your Name *</label><input id="name"></div>
    <div><label>How many people? *</label><input id="party" type="number" min="1" step="1" placeholder="1"></div>
  </div>
  <label>Attendance</label>
  <select id="attendance">
    <option value="all">All weekend</option>
    <option value="partial">Some events</option>
    <option value="none">Can't make it</option>
  </select>
  <label>Selected Events (comma separated ids)</label>
  <input id="events" placeholder="sat-brunch,sat-lunch">
  <label>Is there anything you need to share with us?</label>
  <textarea id="notes" rows="3" placeholder="I love stinky cheese"></textarea>
  <button id="save">Save Changes</button>
</div>
<script>
const qs = new URLSearchParams(location.search);
const token = qs.get('token');
const $ = id => document.getElementById(id);
if (!token) { document.getElementById('status').textContent = 'Missing token.'; throw new Error('no token'); }

fetch('/api/rsvp?token=' + encodeURIComponent(token))
  .then(r => r.json()).then(({ ok, rsvp, error }) => {
    if (!ok) throw new Error(error || 'load failed');
    $('name').value = rsvp.name || '';
    $('party').value = rsvp.partySize || 1;
    $('attendance').value = rsvp.attendance || '';
    $('events').value = (rsvp.selectedEvents || []).join(',');
    $('notes').value = rsvp.notes || '';
  }).catch(e => { document.getElementById('status').textContent = e.message; });

$('save').onclick = async () => {
  const payload = {
    token,
    name: $('name').value.trim(),
    partySize: Number($('party').value)||1,
    attendance: $('attendance').value,
    selectedEvents: $('events').value.split(',').map(s => s.trim()).filter(Boolean),
    notes: $('notes').value.trim()
  };
  const r = await fetch('/api/rsvp?token=' + encodeURIComponent(token), {
    method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload)
  });
  const j = await r.json();
  alert(j.ok ? 'Saved!' : ('Error: ' + (j.error || 'failed')));
};
</script>


